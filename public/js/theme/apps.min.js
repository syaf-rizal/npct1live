var loadingCustom = {
    content: '<div class="header">Please wait <span class="loader" style="float: right; margin-right: 10px !important; padding-top: 7px;"><div class="one"></div><div class="two"></div></span></div><div class="content-msg"> We are processing your request. This can take a few moments.</div>',
    title: 'Meal Application - NPCT1'
}

$(document).ready(function() {

});

function postRequest(_argsForm, container, args) {
    args = typeof args !== 'undefined' ? args : false;
    let _formDataSerialize = new FormData(document.getElementById(_argsForm)),
        _idFormAttribute = '#' + _argsForm,
        _container = $(container),
        _isNotNull = 0,
        _containerTagged = _container.text();
    $.each($("input:visible, select:visible, textarea:visible"), function() {
        if ($(this).attr('wajib') == "yes" && ($(this).val() == "" || $(this).val() == null)) {
            _isNotNull++;
        }
    });
    if (_isNotNull > 0) {
        bootbox.alert('Silahkan isi dengan lengkap pada kolom bertanda <b>*</b>');
        return false;
    } else {
        bootbox.confirm({
            title: "Apakah data yang anda isikan sudah benar?",
            message: "Anda tidak dapat membatalkan proses ini!",
            buttons: {
                cancel: {
                    label: 'Cancel',
                    className: 'btn-wide mb-2 mr-2 btn-transition btn btn-outline-light'
                },
                confirm: {
                    label: 'Ok',
                    className: 'btn-wide mb-2 mr-2 btn-transition btn btn-outline-primary'
                }
            },
            callback: function(result) {
                if (result) {
                    $.ajax({
                        type: 'POST',
                        url: $(_idFormAttribute).attr('action'),
                        data: _formDataSerialize,
                        headers: {
                            dataType: "json",
                            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                        },
                        processData: false,
                        contentType: false,
                        beforeSend: function() {
                            _container.attr('disabled', 'disabled');
                            _container.html('Memproses Data ...');
                            $('.loading-custom').show();
                            $('.loading-custom-content').html(loadingCustom.content);
                        },
                        complete: function() {
                            $('.loading-custom').hide();
                        },
                        success: function(data) {
                            if (data.status == 400) {
                                let msgsNotice = '';
                                for (var msg in data.error) {
                                    msgsNotice += '&bull; ' + data.error[msg][0];
                                    msgsNotice += ' \n ';
                                }
                                bootbox.alert(msgsNotice);
                                _container.removeAttr('disabled');
                                _container.html(_containerTagged);
                            } else if (data.status == 200) {
                                if (data.hasOwnProperty('redirect')) {
                                    if (data.redirect.statement == true) {
                                        bootbox.alert(data.message);
                                        setTimeout(function() {
                                            location.href = data.redirect.url;
                                        }, 2000);
                                    }
                                } else if (data.hasOwnProperty('removeContent') && data.message !== "") {
                                    bootbox.alert(data.message);
                                    ((args) ? $(".inputOverlay").hide(function() { $(args).css({ 'box-shadow': 'none', '-moz-box-shadow': 'none', '-webkit-box-shadow': 'none', '-o-box-shadow': 'none', 'overflow-y': 'hidden' }).html(''); }) : '');
                                } else if (data.hasOwnProperty('message') && data.message == "") {
                                    setTimeout(function() {
                                        location.href = data.url;
                                    }, 2000);
                                } else {
                                    setTimeout(function() {
                                        location.reload(true);
                                    });
                                }
                                _container.html('Completed ...');
                            } else {
                                bootbox.alert('Oops ... Silahkan periksa kembali koneksi internet anda');
                                _container.removeAttr('disabled');
                                _container.html(_containerTagged);
                            }
                            $('.loading-custom').hide();
                        },
                        error: function(data, status, x) {
                            bootbox.alert(data);
                            _container.removeAttr('disabled');
                            _container.html(_containerTagged);
                            $(".loading-custom").hide();
                        }
                    });
                }
            }
        });
    }
    return false;
}

function nakupandaDialogGetCustomizable(c, d) {
    var $this = $(c),
        $data = {
            key: Math.random()
        };
    $.ajax({
        type: 'POST',
        url: $this.attr('data-url'),
        data: $data,
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        },
        dataType: 'html',
        beforeSend: function() {
            $('.loading-custom').show();
            $('.loading-custom-content').html(loadingCustom.content);
        },
        complete: function() {
            $('.loading-custom').hide();
        },
        success: function(data) {
            if ($(".modal-backdrop").length === 0) {
                BootstrapDialog.show({
                    title: '',
                    type: BootstrapDialog.TYPE_PRIMARY,
                    size: d,
                    message: data.replace(/(?:\r\n|\r|\n)/g, ''),
                });
            }
            return false;
        },
        error: function(data, status, x) {
            $('.loading-custom').hide();
        }
    });
    return false;
}